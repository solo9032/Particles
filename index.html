
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smooth Hand Controlled 3D Particle System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
    margin:0;
    overflow:hidden;
    background:#05080d;
    font-family:Segoe UI,Roboto,sans-serif;
}
#ui{
    position:absolute;
    top:20px;
    left:20px;
    z-index:10;
    color:#eaffff;
}
#ui h2{
    margin:0;
    font-weight:300;
    letter-spacing:2px;
}
#status{
    margin-top:8px;
    color:#00ff9c;
}
#video{
    position:absolute;
    bottom:20px;
    right:20px;
    width:220px;
    height:160px;
    border-radius:12px;
    border:2px solid rgba(255,255,255,0.25);
    transform:scaleX(-1);
    opacity:0.85;
    z-index:9;
}
#loading{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-size:22px;
    z-index:20;
}
</style>
</head>

<body>
<div id="loading">Loading AI + 3D Engineâ€¦</div>

<div id="ui">
    <h2>HAND PARTICLE SYSTEM</h2>
    <div id="status">Shape: Sphere</div>
</div>

<video id="video" playsinline></video>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
/* ================== THREE SETUP ================== */
const COUNT = 14000;
const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x05080d,0.0025);

const camera = new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,2000);
camera.position.z = 140;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* ================== PARTICLES ================== */
const geo = new THREE.BufferGeometry();
const pos = new Float32Array(COUNT*3);
const base = new Float32Array(COUNT*3);
const target = new Float32Array(COUNT*3);
const col = new Float32Array(COUNT*3);

for(let i=0;i<COUNT;i++){
    let i3=i*3;
    pos[i3]=base[i3]=(Math.random()-0.5)*120;
    pos[i3+1]=base[i3+1]=(Math.random()-0.5)*120;
    pos[i3+2]=base[i3+2]=(Math.random()-0.5)*120;
    col[i3]=col[i3+1]=col[i3+2]=1;
}
geo.setAttribute("position",new THREE.BufferAttribute(pos,3));
geo.setAttribute("color",new THREE.BufferAttribute(col,3));

const mat = new THREE.PointsMaterial({
    size:0.6,
    vertexColors:true,
    blending:THREE.AdditiveBlending,
    transparent:true,
    depthWrite:false
});

const particles = new THREE.Points(geo,mat);
scene.add(particles);

/* ================== SHAPES ================== */
const shapes=["Sphere","Heart","Flower","Saturn","Fireworks"];
let shapeIndex=0;

function setShape(name){
    for(let i=0;i<COUNT;i++){
        let i3=i*3;
        let p;
        if(name==="Sphere"){
            let t=Math.random()*Math.PI*2;
            let p2=Math.acos(2*Math.random()-1);
            let r=45;
            p={
                x:r*Math.sin(p2)*Math.cos(t),
                y:r*Math.sin(p2)*Math.sin(t),
                z:r*Math.cos(p2)
            };
        }
        if(name==="Heart"){
            let t=Math.random()*Math.PI*2;
            p={
                x:16*Math.pow(Math.sin(t),3)*2,
                y:(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))*2,
                z:(Math.random()-0.5)*15
            };
        }
        if(name==="Flower"){
            let u=Math.random()*Math.PI*2;
            let r=Math.sin(5*u)*30;
            p={x:r*Math.cos(u),y:r*Math.sin(u),z:(Math.random()-0.5)*20};
        }
        if(name==="Saturn"){
            if(Math.random()<0.7){
                let t=Math.random()*Math.PI*2;
                let p2=Math.acos(2*Math.random()-1);
                let r=28;
                p={x:r*Math.sin(p2)*Math.cos(t),y:r*Math.sin(p2)*Math.sin(t),z:r*Math.cos(p2)};
            }else{
                let a=Math.random()*Math.PI*2;
                let r=45+Math.random()*8;
                p={x:r*Math.cos(a),y:(Math.random()-0.5)*2,z:r*Math.sin(a)};
            }
        }
        if(name==="Fireworks"){
            let t=Math.random()*Math.PI*2;
            let p2=Math.acos(2*Math.random()-1);
            let r=Math.cbrt(Math.random())*60;
            p={x:r*Math.sin(p2)*Math.cos(t),y:r*Math.sin(p2)*Math.sin(t),z:r*Math.cos(p2)};
        }
        target[i3]=p.x;
        target[i3+1]=p.y;
        target[i3+2]=p.z;
    }
    document.getElementById("status").innerText="Shape: "+name;
}
setShape("Sphere");

/* ================== HAND STATE ================== */
const state={
    x:0,y:0,
    tx:0,ty:0,
    pinch:1,tpinch:1,
    lastSwitch:0
};

/* ================== MEDIAPIPE ================== */
const video=document.getElementById("video");
const hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
hands.setOptions({
    maxNumHands:1,
    modelComplexity:1,
    minDetectionConfidence:0.7,
    minTrackingConfidence:0.7
});

hands.onResults(res=>{
    if(!res.multiHandLandmarks) return;
    const lm=res.multiHandLandmarks[0];

    state.tx=(lm[9].x-0.5)*2;
    state.ty=-(lm[9].y-0.5)*2;

    const d=Math.hypot(lm[4].x-lm[8].x,lm[4].y-lm[8].y);
    state.tpinch=Math.max(0,Math.min(1,(d-0.03)/0.15));

    let wrist=lm[0],tips=[8,12,16,20];
    let avg=0;
    tips.forEach(t=>avg+=Math.hypot(lm[t].x-wrist.x,lm[t].y-wrist.y));
    avg/=4;

    if(avg<0.25 && Date.now()-state.lastSwitch>1000){
        shapeIndex=(shapeIndex+1)%shapes.length;
        setShape(shapes[shapeIndex]);
        state.lastSwitch=Date.now();
    }
});

new Camera(video,{
    onFrame:async()=>hands.send({image:video}),
    width:640,height:480
}).start();

document.getElementById("loading").style.display="none";

/* ================== ANIMATION ================== */
const clock=new THREE.Clock();
function animate(){
    requestAnimationFrame(animate);

    state.x+= (state.tx-state.x)*0.08;
    state.y+= (state.ty-state.y)*0.08;
    state.pinch+= (state.tpinch-state.pinch)*0.1;

    particles.rotation.y+=0.002+state.x*0.03;
    particles.rotation.x=state.y*0.4;

    const scale=0.6+state.pinch*1.2;
    const hue=(clock.getElapsedTime()*0.05+state.x*0.3)%1;
    const color=new THREE.Color().setHSL(hue,0.85,0.6);

    for(let i=0;i<COUNT;i++){
        let i3=i*3;
        pos[i3]+= (target[i3]-pos[i3])*0.035;
        pos[i3+1]+= (target[i3+1]-pos[i3+1])*0.035;
        pos[i3+2]+= (target[i3+2]-pos[i3+2])*0.035;

        base[i3]=pos[i3]*scale;
        base[i3+1]=pos[i3+1]*scale;
        base[i3+2]=pos[i3+2]*scale;

        col[i3]=color.r;
        col[i3+1]=color.g;
        col[i3+2]=color.b;
    }

    geo.attributes.position.needsUpdate=true;
    geo.attributes.color.needsUpdate=true;

    renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
    camera.aspect=innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
